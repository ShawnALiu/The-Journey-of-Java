
# 1.背景

动、静数据的区别：页面中输出的数据是否和URL、浏览者、时间、地域相关，是否含有Cookie等私密数据。

# 2.静态数据缓存

（1）缓存到用户最近的地方。如：用户浏览器、CDN、服务端Cache。

（2）静态化改造，直接缓存HTTP连接。

（3）谁去缓存静态数据。如：Nginx、Apache、Varnish等Web服务器。

# 3.动静分离改造方案

（1）分离动态内容

①URL唯一化。例如，要缓存整个HTTP连接，可以用URL做缓存key，商品id做分区。

②分离浏览者相关因素，动态请求。例如，是否登录，登录身份。

③分离时间因素。例如，服务端时间动态获取。

③异步化地域因素。例如，详情上的地域因素可以异步获取，也可以动态请求。

⑤去掉Cookie。例如，服务端输出的页面包含Cookie，可以通过代码进行删除，用户端不缓存Cookie。

（2）动态内容处理

①ESI（Edge Side Includes）方案：在Web代理服务器上做动态内容请求，将请求插入到静态页面，用户拿到的是一个完整页面。

特点：影响服务端性能，但用户体验好。

②**CSI（Client Side Includes）** 方案：另外发起JS异步请求，想服务端获取动态数据。

广泛采用方案CSI。

# 4.动静分离后，重新组合方案

（1）实体单机部署

将虚拟机改为实体机，以增大Cache容量，采用一致性Hash分组，提高命中率。

特点：①CPU浪费。②一个实体机既有Java应用，又做为Cache，提升运维复杂度。

（2）统一的Cache层，单独的Cache集群。

（3）**CDN**。

广泛采用方案CDN。
