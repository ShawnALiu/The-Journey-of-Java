
# 1 NameServer架构设计

Broker在启动时向所有NameServer注册，消息生产者（Producer）在发送消息之前先从NameServer获取Broker服务器地址列表，然后根据负载算法从列表中选择一台消息服务器进行消息发送。

NameServer与每台Broker服务器保持长连接，并间隔30s检测Broker是否存活，如果检测到Broker宕机，则从路由注册表中将其移除。但是路由变化不会马上通知消息生产者，这是为了降低NameServer实现的复杂性，在消息发送端提供容错机制来保证消息发送的高可用性。

NameServer本身的高可用可通过部署多台NameSrver服务器来实现，但彼此之间互不通信。即NameServer服务器之间在某一时刻的数据并不会完全相同，但这对消息发送不会造成任何影响。

# 2 NameServer启动流程